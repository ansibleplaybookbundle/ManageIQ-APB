FROM ansibleplaybookbundle/apb-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"aWQ6IGI0MzI1YWVhLTA0NzktNGY4ZC1iNTAyLTE5MjJiYmFlZTEzZQpuYW1lOiBtYW5hZ2VpcS1h\
cGIKbmFtZTogYW5zaWJsZXBsYXlib29rYnVuZGxlL21hbmFnZWlxLWFwYgpkZXNjcmlwdGlvbjog\
TWFuYWdlSVEgYXBiIGltcGxlbWVudGF0aW9uCmJpbmRhYmxlOiBmYWxzZQphc3luYzogb3B0aW9u\
YWwKcGFyYW1ldGVyczoKICAtIG5hbWU6IGFwcGxpY2F0aW9uX2luaXRfZGVsYXkKICAgIGRlc2Ny\
aXB0aW9uOiBUaW1lIHRvIGRlbGF5IHdlYiBhcHAgc3RhcnR1cAogICAgdHlwZTogaW50CiAgICBk\
ZWZhdWx0OiA2MAogIC0gbmFtZTogZGF0YWJhc2VfcmVnaW9uCiAgICBkZXNjcmlwdGlvbjogTUlR\
IEluc3RhbmNlIFJlZ2lvbgogICAgdHlwZTogaW50CiAgICBkZWZhdWx0OiAxCiAgLSBuYW1lOiBk\
YXRhYmFzZV9zZXJ2aWNlX25hbWUKICAgIGRlc2NyaXB0aW9uOiBTZXJ2aWNlIE5hbWUgZm9yIHRo\
ZSBkYXRhYmFzZQogICAgdHlwZTogc3RyaW5nCiAgICBkZWZhdWx0OiBtYW5hZ2VpcS1wb3N0Z3Jl\
c3FsCiAgLSBuYW1lOiBtZW1jYWNoZWRfbWF4X2Nvbm5lY3Rpb25zCiAgICBkZXNjcmlwdGlvbjog\
TWF4aW11bSBudW1iZXIgb2YgY29ubmVjdGlvbnMgbWVtY2FjaGVkIHdpbGwgYWNjZXB0CiAgICB0\
eXBlOiBpbnQKICAgIGRlZmF1bHQ6IDEwMjQKICAtIG5hbWU6IG1lbWNhY2hlZF9tYXhfbWVtb3J5\
CiAgICBkZXNjcmlwdGlvbjogTWF4aW11bSBtZW1vcnkgbWVtY2FjaGVkIHdpbGwgdXNlIGluIE1C\
CiAgICB0eXBlOiBpbnQKICAgIGRlZmF1bHQ6IDY0CiAgLSBuYW1lOiBtZW1jYWNoZWRfc2xhYl9w\
YWdlX3NpemUKICAgIGRlc2NyaXB0aW9uOiBNZW1jYWNoZWQgU2xhYiBTaXplIGluIGJ5dGVzCiAg\
ICB0eXBlOiBzdHJpbmcKICAgIGRlZmF1bHQ6IDFNCiAgLSBuYW1lOiBtZW1jYWNoZWRfc2Vydmlj\
ZV9uYW1lCiAgICBkZXNjcmlwdGlvbjogU2VydmljZSBuYW1lIG9mIHRoZSBtZW1jYWNoZWQgaW5z\
dGFuY2UgdG8gdXNlCiAgICB0eXBlOiBzdHJpbmcKICAgIGRlZmF1bHQ6IG1hbmFnZWlxLW1lbWNh\
Y2hlZAogIC0gbmFtZTogbmFtZXNwYWNlCiAgICBkZXNjcmlwdGlvbjogTmFtZXNwYWNlIHRvIGRl\
cGxveSB0aGUgY2x1c3RlciB0bwogICAgdHlwZTogc3RyaW5nCiAgICBkZWZhdWx0OiBtYW5hZ2Vp\
cS1hcGIKICAtIG5hbWU6IHBvc3RncmVzcWxfZGF0YWJhc2UKICAgIGRlc2NyaXB0aW9uOiBwb3N0\
Z3Jlc3FsIGRhdGFiYXNlIG5hbWUKICAgIHR5cGU6IHN0cmluZwogICAgZGVmYXVsdDogdm1kYl9w\
cm9kdWN0aW9uCiAgLSBuYW1lOiBwb3N0Z3Jlc3FsX3Bhc3N3b3JkCiAgICBkZXNjcmlwdGlvbjog\
cG9zdGdyZXNxbCBkYXRhYmFzZSBwYXNzd29yZAogICAgdHlwZTogc3RyaW5nCiAgICBkZWZhdWx0\
OiBhZG1pbgogIC0gbmFtZTogcG9zdGdyZXNxbF91c2VyCiAgICBkZXNjcmlwdGlvbjogcG9zdGdy\
ZXNxbCBkYXRhYmFzZSB1c2VybmFtZQogICAgdHlwZTogc3RyaW5nCiAgICBkZWZhdWx0OiBhZG1p\
bgo="
ADD playbooks /opt/apb/actions
ADD roles /opt/ansible/roles

RUN useradd -u 1001 -r -g 0 -M -b /opt/apb -s /sbin/nologin -c "apb user" apb
RUN chown -R 1001:0 /opt/{ansible,apb}
USER 1001
